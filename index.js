const { Client, LocalAuth } = require('whatsapp-web.js');
const qrcode = require('qrcode-terminal');

const client = new Client({
    authStrategy: new LocalAuth({
        dataPath: './session'
    })
});

client.on('qr', qr => {
    qrcode.generate(qr, { small: true });
});

client.on('ready', () => {
    console.log('WhatsApp Bot is ready!');
});

const catalog = {
    '–¥—Ä–µ–ª—å': { ru: 'üî© –î—Ä–µ–ª—å Bosch - 5000‚ÇΩ\nüëâ –ö—É–ø–∏—Ç—å: –Ω–∞–ø–∏—à–∏—Ç–µ "–ö—É–ø–∏—Ç—å –¥—Ä–µ–ª—å"', kz: 'üî© –ë“±—Ä“ì—ã Bosch - 5000‚ÇΩ\nüëâ –°–∞—Ç—ã–ø –∞–ª—É “Ø—à—ñ–Ω: "–ö—É–ø–∏—Ç—å –¥—Ä–µ–ª—å" –¥–µ–ø –∂–∞–∑—ã“£—ã–∑' },
    '—à—É—Ä—É–ø–æ–≤–µ—Ä—Ç': { ru: 'üîß –®—É—Ä—É–ø–æ–≤–µ—Ä—Ç Makita - 7500‚ÇΩ\nüëâ –ö—É–ø–∏—Ç—å: –Ω–∞–ø–∏—à–∏—Ç–µ "–ö—É–ø–∏—Ç—å —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç"', kz: 'üîß –ë“±—Ä–∞“ì—ã—à Makita - 7500‚ÇΩ\nüëâ –°–∞—Ç—ã–ø –∞–ª—É “Ø—à—ñ–Ω: "–ö—É–ø–∏—Ç—å —à—É—Ä—É–ø–æ–≤–µ—Ä—Ç" –¥–µ–ø –∂–∞–∑—ã“£—ã–∑' },
    '–±–æ–ª–≥–∞—Ä–∫–∞': { ru: '‚öôÔ∏è –ë–æ–ª–≥–∞—Ä–∫–∞ DeWalt - 8900‚ÇΩ\nüëâ –ö—É–ø–∏—Ç—å: –Ω–∞–ø–∏—à–∏—Ç–µ "–ö—É–ø–∏—Ç—å –±–æ–ª–≥–∞—Ä–∫—É"', kz: '‚öôÔ∏è –ë–æ–ª–≥–∞—Ä–∫–∞ DeWalt - 8900‚ÇΩ\nüëâ –°–∞—Ç—ã–ø –∞–ª—É “Ø—à—ñ–Ω: "–ö—É–ø–∏—Ç—å –±–æ–ª–≥–∞—Ä–∫—É" –¥–µ–ø –∂–∞–∑—ã“£—ã–∑' }
};

let userState = {};

client.on('message', async message => {
    const msg = message.body.toLowerCase();
    const chatId = message.from;

    if (!userState[chatId]) {
        userState[chatId] = { stage: 'language_selection' };
        await message.reply('üåç –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / –¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑:\nüá∑üá∫ –†—É—Å—Å–∫–∏–π\nüá∞üáø “ö–∞–∑–∞“õ—à–∞');
        return;
    }

    if (userState[chatId].stage === 'language_selection') {
        if (msg.includes('—Ä—É—Å—Å–∫–∏–π')) {
            userState[chatId].language = 'ru';
        } else if (msg.includes('“õ–∞–∑–∞“õ—à–∞')) {
            userState[chatId].language = 'kz';
        } else {
            await message.reply('‚ùó –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / –¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑: üá∑üá∫ –†—É—Å—Å–∫–∏–π –∏–ª–∏ üá∞üáø “ö–∞–∑–∞“õ—à–∞');
            return;
        }
        userState[chatId].stage = 'main_menu';
        await message.reply(userState[chatId].language === 'ru' ?
            'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤!\n–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:\n1Ô∏è‚É£ –ö–∞—Ç–∞–ª–æ–≥\n2Ô∏è‚É£ –ü–æ–¥–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞\n3Ô∏è‚É£ –ê–∫—Ü–∏–∏\n4Ô∏è‚É£ –°–≤—è–∑–∞—Ç—å—Å—è —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º' :
            'üëã –≠–ª–µ–∫—Ç—Ä–æ“õ“±—Ä–∞–ª–¥–∞—Ä –¥“Ø–∫–µ–Ω—ñ–Ω–µ “õ–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑!\n–¢–∞“£–¥–∞“£—ã–∑:\n1Ô∏è‚É£ –ö–∞—Ç–∞–ª–æ–≥\n2Ô∏è‚É£ “ö“±—Ä–∞–ª —Ç–∞“£–¥–∞—É\n3Ô∏è‚É£ –ê–∫—Ü–∏—è–ª–∞—Ä\n4Ô∏è‚É£ –ú–µ–Ω–µ–¥–∂–µ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—É');
        return;
    }

    const lang = userState[chatId].language;

    if (msg === '–∫–∞—Ç–∞–ª–æ–≥' || msg === '1') {
        let productList = lang === 'ru' ? 'üõ† –ù–∞—à–∏ —Ç–æ–≤–∞—Ä—ã:\n' : 'üõ† –ë—ñ–∑–¥—ñ“£ ”©–Ω—ñ–º–¥–µ—Ä—ñ–º—ñ–∑:\n';
        for (let product in catalog) {
            productList += `üîπ ${product}\n`;
        }
        await message.reply(productList + (lang === 'ru' ? '\n–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ.' : '\n–ö”©–±—ñ—Ä–µ–∫ –±—ñ–ª—É “Ø—à—ñ–Ω ”©–Ω—ñ–º –∞—Ç–∞—É—ã–Ω –∂–∞–∑—ã“£—ã–∑.'));
    } else if (catalog[msg]) {
        await message.reply(catalog[msg][lang]);
    } else if (msg.includes('–∫—É–ø–∏—Ç—å') || msg.includes('—Å–∞—Ç—ã–ø –∞–ª—É')) {
        userState[chatId].stage = 'waiting_phone';
        await message.reply(lang === 'ru' ? 'üõí –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.' : 'üõí –ö–µ—Ä–µ–º–µ—Ç —Ç–∞“£–¥–∞—É! –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ“£—ñ–∑–¥—ñ –∂–∞–∑—ã“£—ã–∑.');
    } else if (msg === '–ø–æ–¥–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞' || msg === '2') {
        await message.reply(lang === 'ru' ? 'üîç –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ 3 –≤–æ–ø—Ä–æ—Å–∞:\n1Ô∏è‚É£ –ì–¥–µ –±—É–¥–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? (–¥–æ–º/—Å—Ç—Ä–æ–π–∫–∞)' : 'üîç 3 —Å“±—Ä–∞“õ“õ–∞ –∂–∞—É–∞–ø –±–µ—Ä—ñ“£—ñ–∑:\n1Ô∏è‚É£ “ö–∞–π–¥–∞ “õ–æ–ª–¥–∞–Ω–∞—Å—ã–∑? (“Ø–π/“õ“±—Ä—ã–ª—ã—Å)');
    } else if (msg === '–¥–æ–º' || msg === '—Å—Ç—Ä–æ–π–∫–∞' || msg === '“Ø–π' || msg === '“õ“±—Ä—ã–ª—ã—Å') {
        await message.reply(lang === 'ru' ? '2Ô∏è‚É£ –ö–∞–∫–æ–π –±—é–¥–∂–µ—Ç? (–¥–æ 5000 / 5000-10000 / –±–æ–ª—å—à–µ 10000)' : '2Ô∏è‚É£ –ë—é–¥–∂–µ—Ç—ñ“£—ñ–∑ “õ–∞–Ω–¥–∞–π? (5000-“ì–∞ –¥–µ–π—ñ–Ω / 5000-10000 / 10000-–Ω–∞–Ω –∂–æ“ì–∞—Ä—ã)');
    } else if (msg === '–¥–æ 5000' || msg === '5000-10000' || msg === '–±–æ–ª—å—à–µ 10000' || msg === '5000-“ì–∞ –¥–µ–π—ñ–Ω' || msg === '5000-10000' || msg === '10000-–Ω–∞–Ω –∂–æ“ì–∞—Ä—ã') {
        await message.reply(lang === 'ru' ? 'üí° –ü–æ–¥–±–∏—Ä–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç... üîÑ\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º: –î—Ä–µ–ª—å Bosch 5000‚ÇΩ.\n–ù–∞–ø–∏—à–∏—Ç–µ "–ö—É–ø–∏—Ç—å –¥—Ä–µ–ª—å" –¥–ª—è –∑–∞–∫–∞–∑–∞.' : 'üí° “ö“±—Ä–∞–ª —Ç–∞“£–¥–∞–ª—É–¥–∞... üîÑ\n“∞—Å—ã–Ω—ã—Å: –ë“±—Ä“ì—ã Bosch 5000‚ÇΩ.\n–°–∞—Ç—ã–ø –∞–ª—É “Ø—à—ñ–Ω "–ö—É–ø–∏—Ç—å –¥—Ä–µ–ª—å" –∂–∞–∑—ã“£—ã–∑.');
    } else {
        await message.reply(lang === 'ru' ? '–ù–µ –ø–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å. –ù–∞–ø–∏—à–∏—Ç–µ "–ú–µ–Ω—é" –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥.' : '–°“±—Ä–∞–Ω—ã—Å—ã“£—ã–∑–¥—ã —Ç“Ø—Å—ñ–Ω–±–µ–¥—ñ–º. "–ú–µ–Ω—é" –∂–∞–∑—ã“£—ã–∑.');
    }
});

client.initialize();
