const { Client, LocalAuth } = require("whatsapp-web.js");
const fetch = require("node-fetch");

const client = new Client({
    authStrategy: new LocalAuth(),
});

let userData = {}; // –•—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—è–∑—ã–∫ + –≥–æ—Ä–æ–¥)

// –ù–æ–º–µ—Ä–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ç –Ω–µ –±—É–¥–µ—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å
const ignoredNumbers = [
    "7778295140@c.us",
    "77781728440@c.us",
    "0987654321@c.us"
];

client.on("qr", (qr) => {
    console.log("QR-–∫–æ–¥ –ø–æ–ª—É—á–µ–Ω, –æ—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ WhatsApp.");
});

client.on("authenticated", () => {
    console.log("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω! ‚úÖ");
});

client.on("ready", () => {
    console.log("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω! ‚úÖ");
});

client.on("message", async (msg) => {
    const chatId = msg.from;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –Ω–æ–º–µ—Ä –≤ —Å–ø–∏—Å–∫–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö
    if (ignoredNumbers.includes(chatId)) {
        console.log(`–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${chatId} –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ.`);
        return;
    }

    console.log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${chatId}: ${msg.body}`);

    try {
        let text = msg.body.trim(); // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã

        // –í—ã–±–æ—Ä —è–∑—ã–∫–∞
        if (!userData[chatId]) {
            if (text === "1") {
                userData[chatId] = { language: "kk" };
                await client.sendMessage(chatId, 
                    "‚úÖ –°—ñ–∑ “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω —Ç–∞“£–¥–∞–¥—ã“£—ã–∑!\n\n" +
                    "‚Ä¢  –°–∞“ì—ã–∑ Love is ü©∑\n5—à—Ç 2490—Ç–≥ (1–ø–∞—á–∫–∞=5—Å–∞“ì—ã–∑)\n10—à—Ç 2990—Ç–≥ (2 –ø–∞—á–∫–∞=10—Å–∞“ì—ã–∑)\n15—à—Ç 3990—Ç–≥ (3 –ø–∞—á–∫–∞ –Ω–µ–º–µ—Å–µ 1 “Ø–ª–∫–µ–Ω)\n\n" +
                    "‚Ä¢  –ò–º–µ–Ω–Ω–æ–π –∫–∏–Ω–¥–µ—Äüç´ 3490—Ç–≥\n‚Ä¢  –ò–º–µ–Ω–Ω–æ–π Toffifeeüç¨ 3490—Ç–≥\n\n" +
                    "üìç –ë—ñ–∑ –ê–ª–º–∞—Ç—ã “õ–∞–ª–∞—Å—ã\nüì¶ –î–æ—Å—Ç–∞–≤–∫–∞ “ö–∞–∑–∞“õ—Å—Ç–∞–Ω –±–æ–π—ã–Ω—à–∞ (4-7 –∫“Ø–Ω, 2500—Ç–≥)\n\n" +
                    "üìç “ö–∞–ª–∞ —Ç–∞“£–¥–∞“£—ã–∑:\n\n1Ô∏è‚É£ –ê–ª–º–∞—Ç—ã\n2Ô∏è‚É£ –ë–∞—Å“õ–∞ “õ–∞–ª–∞\n3Ô∏è‚É£ “ö–∞–π—Ç–∞ —Ç—ñ–ª —Ç–∞“£–¥–∞—É / –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫"
                );
                return;
            } else if (text === "2") {
                userData[chatId] = { language: "ru" };
                await client.sendMessage(chatId, 
                    "‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫!\n\n" +
                    "‚Ä¢  –ñ–≤–∞—á–∫–∞ Love is ü©∑\n5—à—Ç 2490—Ç–≥ (1 –ø–∞—á–∫–∞ = 5 –∂–≤–∞—á–µ–∫)\n10—à—Ç 2990—Ç–≥ (2 –ø–∞—á–∫–∏ = 10 –∂–≤–∞—á–µ–∫)\n15—à—Ç 3990—Ç–≥ (3 –ø–∞—á–∫–∏ –∏–ª–∏ 1 –±–æ–ª—å—à–∞—è)\n\n" +
                    "‚Ä¢  –ò–º–µ–Ω–Ω–æ–π –∫–∏–Ω–¥–µ—Ä üç´ 3490—Ç–≥\n‚Ä¢  –ò–º–µ–Ω–Ω–æ–π Toffifee üç¨ 3490—Ç–≥\n\n" +
                    "üìç –ú—ã –≤ –ê–ª–º–∞—Ç—ã\nüì¶ –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É (4-7 –¥–Ω–µ–π, 2500—Ç–≥)\n\n" +
                    "üìç –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥:\n\n1Ô∏è‚É£ –ê–ª–º–∞—Ç—ã\n2Ô∏è‚É£ –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥\n3Ô∏è‚É£ –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ / “ö–∞–π—Ç–∞ —Ç—ñ–ª —Ç–∞“£–¥–∞—É"
                );
                return;
            }

            await client.sendMessage(
                chatId,
                "‚úã –°”ô–ª–µ–º–µ—Ç—Å—ñ–∑ –±–µ  | –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ\nüåç –¢—ñ–ª–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ | –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:\n\n1Ô∏è‚É£ “ö–∞–∑–∞“õ—à–∞ üá∞üáø\n2Ô∏è‚É£ –†—É—Å—Å–∫–∏–π üá∑üá∫\n\n1 –Ω–µ–º–µ—Å–µ 2 —Å–∞–Ω—ã–Ω –∂—ñ–±–µ—Ä—ñ“£—ñ–∑ | –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ü–∏—Ñ—Ä—É 1 –∏–ª–∏ 2"
            );
            return;
        }

        // –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞
        if (!userData[chatId].city) {
            if (text === "1") {
                userData[chatId].city = "–ê–ª–º–∞—Ç—ã";
                await client.sendMessage(chatId, 
                    userData[chatId].language === "kk"
                        ? "‚úÖ –°—ñ–∑ –ê–ª–º–∞—Ç—ã “õ–∞–ª–∞—Å—ã–Ω —Ç–∞“£–¥–∞–¥—ã“£—ã–∑!\n‚úÖ –ï—Ä—Ç–µ“£ –∫–µ—à–∫—ñ 18:00-–¥–µ –¥–∞–π—ã–Ω –±–æ–ª–∞–¥—ã\n\n" +
                          "üî¥ –ê–ª—ã–ø –∫–µ—Ç—É –º–µ–∫–µ–Ω-–∂–∞–π—ã: –†–∞–π—ã–º–±–µ–∫–∞ 206–∫\nüöö –î–æ—Å—Ç–∞–≤–∫–∞ –Ø–Ω–¥–µ–∫—Å –∞—Ä“õ—ã–ª—ã –±”©–ª–µ–∫ —Ç”©–ª–µ–Ω–µ–¥—ñ\n\n" +
                          "üìå –ó–∞–∫–∞–∑ –±–µ—Ä—É “Ø—à—ñ–Ω —Ñ–æ—Ç–æ–ª–∞—Ä + –æ–ø–ª–∞—Ç–∞ –∂—ñ–±–µ—Ä–µ—Å—ñ–∑:\nüí≥ –ö–∞—Å–ø–∏: +7 778 295-14-03 (–°–∞–±—ã—Ä –ó.)"
                        : "‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏ –ê–ª–º–∞—Ç—ã!\n‚úÖ –í–∞—à –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∑–∞–≤—Ç—Ä–∞ –∫ 18:00\n\n" +
                          "üî¥ –ê–¥—Ä–µ—Å —Å–∞–º–æ–≤—ã–≤–æ–∑–∞: –†–∞–π—ã–º–±–µ–∫–∞ 206–∫\nüöö –î–æ—Å—Ç–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ\n\n" +
                          "üìå –ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ + –æ–ø–ª–∞—Ç—É:\nüí≥ Kaspi: +7 778 295-14-03 (–°–∞–±—ã—Ä –ó.)"
                );
                return;
            } else if (text === "2") {
                userData[chatId].city = "–î—Ä—É–≥–æ–π";
                await client.sendMessage(chatId, 
                    userData[chatId].language === "kk"
                        ? "‚úÖ –°—ñ–∑ –±–∞—Å“õ–∞ “õ–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞–¥—ã“£—ã–∑!\n‚úÖ –ï—Ä—Ç–µ“£ 15:00-–¥–µ –¥–∞–π—ã–Ω –±–æ–ª“ì–∞–Ω —Å–æ“£\nüì¶ –ü–æ—á—Ç–∞“ì–∞ –±–∞—Ä—ã–ø —Å–∞–ª—ã–ø –∂—ñ–±–µ—Ä–µ–º—ñ–∑\nüöö –ü–æ—á—Ç–∞ 2500—Ç–≥ (–∂–µ—Ç–∫—ñ–∑—É 4-7 –∫“Ø–Ω)\n\n" +
                          "üìå –ó–∞–∫–∞–∑ –±–µ—Ä—É “Ø—à—ñ–Ω —Ñ–æ—Ç–æ–ª–∞—Ä + –æ–ø–ª–∞—Ç–∞ –∂—ñ–±–µ—Ä–µ—Å—ñ–∑:\nüí≥ –ö–∞—Å–ø–∏: +7 778 295-14-03 (–°–∞–±—ã—Ä –ó.)"
                        : "‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏ –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥!\n‚úÖ –ó–∞–≤—Ç—Ä–∞ –≤ 15:00 –∑–∞–∫–∞–∑ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤\nüì¶ –û—Ç–ø—Ä–∞–≤–∏–º —á–µ—Ä–µ–∑ –ø–æ—á—Ç—É\nüöö –î–æ—Å—Ç–∞–≤–∫–∞ 2500 —Ç–≥ (—Å—Ä–æ–∫ 4-7 –¥–Ω–µ–π)\n\n" +
                          "üìå –ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ + –æ–ø–ª–∞—Ç—É:\nüí≥ Kaspi: +7 778 295-14-03 (–°–∞–±—ã—Ä –ó.)"
                );
                return;
            } else if (text === "3") {
                delete userData[chatId];
                await client.sendMessage(chatId, "üîÑ –¢—ñ–ª–¥—ñ “õ–∞–π—Ç–∞ —Ç–∞“£–¥–∞“£—ã–∑ / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∑–∞–Ω–æ–≤–æ:\n\n1Ô∏è‚É£ “ö–∞–∑–∞“õ—à–∞ üá∞üáø\n2Ô∏è‚É£ –†—É—Å—Å–∫–∏–π üá∑üá∫");
                return;
            }

            await client.sendMessage(
                chatId,
                userData[chatId].language === "kk"
                    ? "üìç –°—ñ–∑ “õ–∞–ª–∞ —Ç–∞“£–¥–∞“£—ã–∑:\n\n1Ô∏è‚É£ –ê–ª–º–∞—Ç—ã\n2Ô∏è‚É£ –ë–∞—Å“õ–∞ “õ–∞–ª–∞\n3Ô∏è‚É£ “ö–∞–π—Ç–∞ —Ç—ñ–ª —Ç–∞“£–¥–∞—É / –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫"
                    : "üìç –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥:\n\n1Ô∏è‚É£ –ê–ª–º–∞—Ç—ã\n2Ô∏è‚É£ –î—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥\n3Ô∏è‚É£ –°–º–µ–Ω–∏—Ç—å —è–∑—ã–∫ / “ö–∞–π—Ç–∞ —Ç—ñ–ª —Ç–∞“£–¥–∞—É"
            );
            return;
        }
        
        // –ï—Å–ª–∏ —É–∂–µ –≤—ã–±—Ä–∞–Ω—ã —è–∑—ã–∫ –∏ –≥–æ—Ä–æ–¥
        client.on("message", async (msg) => {
            const chatId = msg.from;
            if (ignoredNumbers.includes(chatId)) return;
            console.log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç ${chatId}: ${msg.body}`);
            
            let text = msg.body.trim();
            
            if (!userData[chatId]) {
                userData[chatId] = { language: "ru" };
            }
            
        });
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:", error);
    }
});

client.initialize();
